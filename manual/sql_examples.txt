--- Выборка для IPTV (7 дней) --- 
(вместо Светлоград указывается населенный пункт)

SELECT
 phone_number 'Номер тел.',
 ad.locality 'Нас. пункт',
 ad.street 'Улица',
 ad.house_number 'Дом',
 ad.apartment_number '№ кв.',
 MIN(dd.max_dw_rate) 'Мин. вх. скор.',
 MAX(dd.max_dw_rate) 'Макс. вх. скор.'
FROM abon_dsl ad INNER JOIN data_dsl dd
 ON ad.hostname=dd.hostname
 AND ad.board=dd.board
 AND ad.port=dd.port
WHERE
 dd.datetime >= DATE_ADD(CURRENT_DATE(), INTERVAL -7 DAY)
 AND dd.max_dw_rate IS NOT NULL
 AND ad.tv = 'no'
 AND ad.locality LIKE '%Светлоград%'
GROUP BY ad.phone_number
HAVING MIN(dd.max_dw_rate) > 15000
ORDER BY ad.street, CAST(ad.house_number AS INT);


--- Статистика улицы с прошлого дня ---
(вместо Светлоград указывается населенный пункт, вместо Уральская указывается улица)

SELECT
 ad.street 'Улица',
 ad.house_number 'Дом',
 ad.apartment_number '№ кв.',
 RIGHT(ad.phone_number, 5) 'Номер тел.',
 ROUND(AVG(dd.max_up_rate)) 'Ср. исх. скор.',
 ROUND(AVG(dd.max_dw_rate)) 'Ср. вх. скор.'
FROM abon_dsl ad INNER JOIN data_dsl dd
 ON ad.hostname=dd.hostname
 AND ad.board=dd.board
 AND ad.port=dd.port
WHERE
 dd.datetime >= DATE_ADD(CURRENT_DATE(), INTERVAL -1 DAY)
 AND ad.locality LIKE '%Светлоград%'
 AND ad.street LIKE '%Уральская%'
GROUP BY ad.phone_number
HAVING
 AVG(dd.max_up_rate) IS NOT NULL
 AND AVG(dd.max_dw_rate) IS NOT NULL
ORDER BY CAST(ad.house_number AS INT), ad.apartment_number;


--- Статистика абонента по дням (мин., макс., сред. скорость) ---
(вместо 8654740169 указывается номер телефона)

SELECT
 ad.phone_number 'Номер тел.',
 dd.hostname 'Hostname',
 dd.board 'Board',
 dd.port 'Port',
 MIN(dd.max_dw_rate) 'Мин. вх. скор.',
 MAX(dd.max_dw_rate) 'Макс. вх. скор.',
 ROUND(AVG(dd.max_dw_rate)) 'Сред. вх. скор.',
 CAST(dd.datetime AS DATE) 'Дата'
FROM abon_dsl ad INNER JOIN data_dsl dd
 ON ad.hostname=dd.hostname
 AND ad.board=dd.board
 AND ad.port=dd.port
WHERE
 ad.phone_number = '8654740169'
 AND ad.valid = 'yes'
GROUP BY CAST(dd.datetime AS DATE)
ORDER BY dd.datetime;


--- Статистика порта по дням (мин., макс., сред. скорость) ---
(вместо 'STV-SVET-ATS4-DSL3-H5600' указывается hostname, board - плата, port - номер порта)
SELECT
 hostname 'Hostname',
 board 'Board',
 port 'Port',
 MIN(max_dw_rate) 'Мин. вх. скор.',
 MAX(max_dw_rate) 'Макс. вх. скор.',
 ROUND(AVG(max_dw_rate)) 'Сред. вх. скор.',
 CAST(datetime AS DATE) 'Дата'
FROM data_dsl
WHERE
 hostname = 'STV-SVET-ATS4-DSL3-H5600'
 AND board=1
 AND port=49
GROUP BY CAST(datetime AS DATE)
ORDER BY datetime;


--- Статистика абонента за последние 3 дня по часам ---
(вместо 8654740169 указывается номер телефона)

SELECT
 ad.phone_number 'Номер тел.',
 dd.hostname 'Hostname',
 dd.board 'Board',
 dd.port 'Port',
 dd.max_up_rate 'Макс. исх. скор.',
 dd.max_dw_rate 'Макс. вх. скор.',
 dd.up_rate 'Исх. скор.',
 dd.dw_rate 'Вх. скор.',
 dd.datetime 'Дата/Время'
FROM abon_dsl ad INNER JOIN data_dsl dd
 ON ad.hostname=dd.hostname
 AND ad.board=dd.board
 AND ad.port=dd.port
WHERE
 dd.datetime >= DATE_ADD(CURRENT_DATE(), INTERVAL -3 DAY)
 AND ad.phone_number = '8654740169'
ORDER BY dd.datetime;


--- Статистика порта за последние 3 дня по часам ---
(вместо 'STV-SVET-ATS4-DSL3-H5600' указывается hostname, board - плата, port - номер порта)

SELECT
 hostname 'Hostname',
 board 'Board',
 port 'Port',
 max_up_rate 'Макс. исх. скор.',
 max_dw_rate 'Макс. вх. скор.',
 up_rate 'Исх. скор.',
 dw_rate 'Вх. скор.',
 datetime 'Дата/Время'
FROM data_dsl
WHERE
 datetime >= DATE_ADD(CURRENT_DATE(), INTERVAL -3 DAY)
 AND hostname = 'STV-SVET-ATS4-DSL3-H5600'
 AND board=1
 AND port=49
ORDER BY datetime;

